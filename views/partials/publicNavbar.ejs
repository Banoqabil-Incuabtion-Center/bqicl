<%- include('themeHeader') %>

    <nav
        class="fixed top-0 w-full z-50 glass border-b border-black/5 dark:border-white/5 h-20 md:h-24 flex items-center transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 w-full flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="/" class="flex items-center gap-4">
                    <div class="h-10 w-10 sm:h-14 sm:w-14 p-1">
                        <img src="/logo.png" alt="ICL Logo" class="h-full w-full object-contain">
                    </div>
                    <div>
                        <span class="text-lg sm:text-2xl font-black tracking-tighter text-white uppercase italic">
                            ICL
                        </span>
                        <div
                            class="text-[8px] sm:text-[10px] text-lime-500 font-bold tracking-[0.2em] uppercase -mt-1 hidden sm:block">
                            Incubation Cricket League</div>
                    </div>
                </a>
            </div>

            <!-- Desktop Links -->
            <div class="hidden lg:flex items-center gap-8">
                <a href="/" data-nav="home"
                    class="nav-link text-xs font-black uppercase tracking-widest transition-all italic text-gray-400 hover:text-white">Home</a>
                <a href="/#about" data-nav="about"
                    class="nav-link text-xs font-black uppercase tracking-widest transition-all italic text-gray-400 hover:text-white">About</a>
                <a href="/players" data-nav="players"
                    class="nav-link text-xs font-black uppercase tracking-widest transition-all italic text-gray-400 hover:text-white">Players</a>
                <a href="/teams" data-nav="teams"
                    class="nav-link text-xs font-black uppercase tracking-widest transition-all italic text-gray-400 hover:text-white">Teams</a>
                <a href="/auction" data-nav="auction"
                    class="nav-link text-xs font-black uppercase tracking-widest transition-all italic text-lime-500 hover:text-lime-400 shadow-lime-500/10">Live
                    Auction</a>
            </div>

            <div class="flex items-center gap-4 sm:gap-6">
                <% if (locals.user) { %>
                    <a href="/<%= locals.user.role === 'admin' ? 'admin' : 'owner' %>/dashboard"
                        class="px-4 py-2 sm:px-6 sm:py-2.5 text-[10px] sm:text-sm font-bold bg-lime-500 text-black rounded-lg transition-all shadow-lg shadow-lime-900/40 hover:scale-105 active:scale-95 uppercase italic">
                        Dashboard <i class="fas fa-bolt ml-2 text-[10px]"></i>
                    </a>
                    <% } else { %>
                        <div class="hidden sm:flex gap-4 items-center">
                            <a href="/auth/owner/signin"
                                class="px-5 py-2 text-xs font-bold border-2 border-white/10 text-white hover:bg-white hover:text-black rounded-lg transition-all uppercase tracking-widest italic">Owner</a>
                            <a href="/auth/admin/signin"
                                class="px-5 py-2 text-xs font-bold border-2 border-lime-500 text-lime-500 hover:bg-lime-500 hover:text-black rounded-lg transition-all uppercase tracking-widest italic">Admin</a>
                        </div>
                        <% } %>
                            <!-- Theme Toggle -->
                            <button id="theme-toggle"
                                class="p-2.5 rounded-xl bg-black/5 dark:bg-white/5 text-gray-500 dark:text-gray-400 hover:text-lime-500 dark:hover:text-lime-400 transition-all border border-black/5 dark:border-white/5">
                                <i class="fas fa-moon dark:hidden"></i>
                                <i class="fas fa-sun hidden dark:block"></i>
                            </button>

                            <!-- Mobile Toggle always visible for guest/logged-in -->
                            <button id="mobile-menu-btn"
                                class="lg:hidden text-gray-900 dark:text-white text-2xl p-2 focus:outline-none">
                                <i class="fas fa-bars"></i>
                            </button>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu"
            class="lg:hidden hidden fixed top-20 md:top-24 left-0 w-full border-t border-white/5 bg-black/95 backdrop-blur-3xl z-40">
            <div class="flex flex-col p-6 gap-4">
                <a href="/" data-nav="home"
                    class="nav-link text-sm font-black uppercase tracking-widest transition-all italic text-gray-400 hover:text-white">Home</a>
                <a href="/#about" data-nav="about"
                    class="nav-link text-sm font-black uppercase tracking-widest transition-all italic text-gray-400 hover:text-white">About</a>
                <a href="/players" data-nav="players"
                    class="nav-link text-sm font-black uppercase tracking-widest transition-all italic text-gray-400 hover:text-white">Players</a>
                <a href="/teams" data-nav="teams"
                    class="nav-link text-sm font-black uppercase tracking-widest transition-all italic text-gray-400 hover:text-white">Teams</a>
                <a href="/auction" data-nav="auction"
                    class="nav-link text-sm font-black uppercase tracking-widest transition-all italic text-lime-500 hover:text-lime-400">Live
                    Auction</a>
                <hr class="border-white/5 my-2">
                <% if (!locals.user) { %>
                    <a href="/auth/owner/signin" class="text-sm font-bold text-gray-400 uppercase italic">Owner
                        Portal</a>
                    <a href="/auth/admin/signin"
                        class="text-sm font-bold text-lime-500 uppercase italic font-black">Admin
                        Access</a>
                    <% } else { %>
                        <a href="/<%= locals.user.role === 'admin' ? 'admin' : 'owner' %>/dashboard"
                            class="text-sm font-black text-lime-500 uppercase italic">Dashboard</a>
                        <% } %>
            </div>
        </div>
    </nav>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Navbar Scroll Effect
            window.addEventListener('scroll', () => {
                const nav = document.querySelector('nav');
                if (window.scrollY > 20) {
                    nav.classList.add('bg-black/80', 'backdrop-blur-xl');
                } else {
                    nav.classList.remove('bg-black/80', 'backdrop-blur-xl');
                }
            });

            // Active Link Highlighting
            const updateActiveLinks = () => {
                const path = window.location.pathname;
                const links = document.querySelectorAll('.nav-link');

                links.forEach(l => {
                    if (l.getAttribute('data-nav') === 'auction') {
                        l.classList.add('text-lime-500');
                        l.classList.remove('text-white', 'text-gray-400');
                    } else {
                        l.classList.remove('text-lime-500', 'text-white');
                        l.classList.add('text-gray-400');
                    }
                });

                if (path === '/' || path === '') {
                    document.querySelectorAll('[data-nav="home"]').forEach(l => {
                        l.classList.add('text-lime-500', 'font-black');
                        l.classList.remove('text-gray-400', 'text-white');
                    });
                } else if (path.startsWith('/players')) {
                    document.querySelectorAll('[data-nav="players"]').forEach(l => {
                        l.classList.add('text-lime-500', 'font-black');
                        l.classList.remove('text-gray-400', 'text-white');
                    });
                } else if (path.startsWith('/teams')) {
                    document.querySelectorAll('[data-nav="teams"]').forEach(l => {
                        l.classList.add('text-lime-500', 'font-black');
                        l.classList.remove('text-gray-400', 'text-white');
                    });
                } else if (path.startsWith('/auction')) {
                    document.querySelectorAll('[data-nav="auction"]').forEach(l => {
                        l.classList.add('text-lime-500', 'font-black');
                        l.classList.remove('text-gray-400', 'text-white');
                    });
                }
            };

            // Intersection Observer for sections
            if (window.location.pathname === '/' || window.location.pathname === '') {
                const observerOptions = { threshold: 0.5 };
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const id = entry.target.id;
                            const links = document.querySelectorAll('.nav-link');
                            if (id === 'about') {
                                links.forEach(l => {
                                    if (l.getAttribute('data-nav') === 'about') {
                                        l.classList.add('text-lime-500', 'font-black');
                                        l.classList.remove('text-gray-400', 'text-white');
                                    } else if (l.getAttribute('data-nav') === 'home') {
                                        l.classList.remove('text-lime-500', 'text-white', 'font-black');
                                        l.classList.add('text-gray-400');
                                    }
                                });
                            } else if (id === 'home' || entry.target.tagName === 'HEADER') {
                                links.forEach(l => {
                                    if (l.getAttribute('data-nav') === 'home') {
                                        l.classList.add('text-lime-500', 'font-black');
                                        l.classList.remove('text-gray-400', 'text-white');
                                    } else if (l.getAttribute('data-nav') === 'about') {
                                        l.classList.remove('text-lime-500', 'text-white', 'font-black');
                                        l.classList.add('text-gray-400');
                                    }
                                });
                            }
                        }
                    });
                }, observerOptions);

                const sections = ['home', 'about'];
                sections.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) observer.observe(el);
                });
            }

            updateActiveLinks();

            // Mobile Menu
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                    const icon = mobileMenuBtn.querySelector('i');
                    if (mobileMenu.classList.contains('hidden')) {
                        icon.classList.replace('fa-times', 'fa-bars');
                    } else {
                        icon.classList.replace('fa-bars', 'fa-times');
                    }
                });

                mobileMenu.querySelectorAll('a').forEach(link => {
                    link.addEventListener('click', () => {
                        mobileMenu.classList.add('hidden');
                        const icon = mobileMenuBtn.querySelector('i');
                        if (icon) icon.classList.replace('fa-times', 'fa-bars');
                    });
                });
            }

            // Smooth Scroll
            document.querySelectorAll('a[href^="/#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    if (window.location.pathname === '/' || window.location.pathname === '') {
                        const targetId = this.getAttribute('href').split('#')[1];
                        const targetElement = document.getElementById(targetId);
                        if (targetElement) {
                            e.preventDefault();
                            targetElement.scrollIntoView({ behavior: 'smooth' });
                        }
                    }
                });
            });

            // Theme Toggle
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    if (document.documentElement.classList.contains('dark')) {
                        document.documentElement.classList.remove('dark');
                        localStorage.setItem('theme', 'light');
                    } else {
                        document.documentElement.classList.add('dark');
                        localStorage.setItem('theme', 'dark');
                    }
                });
            }
        });
    </script>