<%- include('layouts/public_header') %>

    <style>
        .responsive-bid {
            font-size: clamp(3rem, 12vw, 8rem);
            line-height: 1;
            text-shadow: 0 0 40px rgba(56, 176, 0, 0.4);
        }

        .responsive-name {
            font-size: clamp(2rem, 7vw, 4rem);
            line-height: 1.1;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .float-anim {
            animation: float 5s ease-in-out infinite;
        }
    </style>

    <main class="flex-grow flex items-center justify-center relative w-full px-4 py-12">
        <!-- Ambient Lighting -->
        <div class="absolute top-1/4 right-1/4 w-96 h-96 bg-lime-500/10 rounded-full blur-[120px] animate-pulse"></div>
        <div
            class="absolute bottom-1/4 left-1/4 w-96 h-96 bg-emerald-500/10 rounded-full blur-[120px] animate-pulse delay-1000">
        </div>

        <div class="w-full max-w-7xl relative z-10">

            <!-- Waiting UI (Shown when no active auction) -->
            <div id="waiting-ui" class="text-center py-20 space-y-8">
                <div
                    class="inline-flex items-center justify-center w-24 h-24 bg-white/5 rounded-3xl border border-white/10 mb-6 relative group overflow-hidden">
                    <div
                        class="absolute inset-0 bg-lime-500/10 scale-0 group-hover:scale-100 transition-transform duration-500 rounded-full blur-xl">
                    </div>
                    <i
                        class="fas fa-satellite-dish text-4xl text-gray-500 group-hover:text-lime-500 transition-colors animate-pulse"></i>
                </div>
                <h2
                    class="text-4xl md:text-6xl font-black italic uppercase italic tracking-tighter text-gray-900 dark:text-white">
                    Arena <span class="text-lime-500">Standby</span>
                </h2>
                <p class="text-gray-500 dark:text-slate-400 text-lg md:text-xl font-medium max-w-2xl mx-auto">
                    The auction block is currently clear. Please wait for the administrator to call the next elite
                    talent.
                </p>
                <div class="flex items-center justify-center gap-4">
                    <span class="h-2 w-2 rounded-full bg-lime-500 animate-bounce"></span>
                    <span class="h-2 w-2 rounded-full bg-lime-500 animate-bounce delay-100"></span>
                    <span class="h-2 w-2 rounded-full bg-lime-500 animate-bounce delay-200"></span>
                </div>
            </div>

            <!-- Active Auction UI -->
            <div id="active-ui" class="hidden animate-in fade-in zoom-in duration-700">
                <div class="grid lg:grid-cols-2 gap-12 items-center">

                    <!-- Player Visual -->
                    <div class="relative group">
                        <div
                            class="absolute -inset-4 bg-lime-500/20 blur-2xl rounded-[3rem] opacity-0 group-hover:opacity-100 transition-opacity duration-700">
                        </div>
                        <div
                            class="relative aspect-square overflow-hidden rounded-[2.5rem] border border-white/10 shadow-2xl float-anim">
                            <img id="proj-img" src="/images/default-player.png" alt="Player"
                                class="w-full h-full object-cover">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent">
                            </div>
                            <div class="absolute bottom-8 left-8 right-8">
                                <span id="proj-auction-category"
                                    class="px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest border border-white/20 bg-black/40 backdrop-blur-md text-white mb-3 inline-block">
                                    Category
                                </span>
                                <h2 id="proj-name"
                                    class="text-4xl md:text-5xl font-black text-white italic uppercase tracking-tighter truncate">
                                    ---</h2>
                            </div>
                        </div>
                    </div>

                    <!-- Auction Stats -->
                    <div class="space-y-8">
                        <div class="glass p-8 md:p-12 rounded-[2.5rem] relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-lime-500/5 blur-3xl rounded-full"></div>

                            <div class="mb-10 text-center lg:text-left">
                                <p class="text-[10px] font-black uppercase tracking-[0.3em] text-lime-500/70 mb-2">Live
                                    Bidding Arena</p>
                                <div id="proj-bid" class="responsive-bid font-black text-lime-500 italic">
                                    $0
                                </div>
                                <div class="flex items-center gap-3 mt-4 justify-center lg:justify-start">
                                    <span class="h-2 w-2 rounded-full bg-red-500 animate-ping"></span>
                                    <p id="proj-bidder"
                                        class="text-xs font-black uppercase tracking-widest text-gray-400">--- leading
                                        the bid</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div
                                    class="bg-black/5 dark:bg-white/5 p-5 rounded-2xl border border-black/5 dark:border-white/5">
                                    <p class="text-[9px] font-black text-gray-500 uppercase tracking-widest mb-1">Base
                                        Valuation</p>
                                    <p id="proj-base" class="text-xl font-black text-gray-900 dark:text-white">$0</p>
                                </div>
                                <div
                                    class="bg-black/5 dark:bg-white/5 p-5 rounded-2xl border border-black/5 dark:border-white/5">
                                    <p class="text-[9px] font-black text-gray-500 uppercase tracking-widest mb-1">Campus
                                    </p>
                                    <p id="proj-campus" class="text-xl font-black text-gray-900 dark:text-white">---</p>
                                </div>
                                <div
                                    class="bg-black/5 dark:bg-white/5 p-5 rounded-2xl border border-black/5 dark:border-white/5">
                                    <p class="text-[9px] font-black text-gray-500 uppercase tracking-widest mb-1">
                                        Specialization</p>
                                    <p id="proj-cat" class="text-xl font-black text-gray-900 dark:text-white">---</p>
                                </div>
                                <div
                                    class="bg-black/5 dark:bg-white/5 p-5 rounded-2xl border border-black/5 dark:border-white/5">
                                    <p class="text-[9px] font-black text-gray-500 uppercase tracking-widest mb-1">
                                        Auction Status</p>
                                    <p class="text-xl font-black text-lime-500 group flex items-center gap-2">
                                        <span class="h-1.5 w-1.5 rounded-full bg-lime-500 animate-pulse"></span>
                                        ACTIVE
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Bid History Mini List -->
                        <div class="glass p-6 rounded-3xl border border-white/5">
                            <h3
                                class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                                <i class="fas fa-history text-lime-500"></i> Recent Bidding Activity
                            </h3>
                            <div id="recent-bids-container" class="space-y-3">
                                <!-- Bids injected here -->
                                <p class="text-[10px] text-gray-500 italic font-bold">Waiting for initial bid...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script>
        const waitingUI = document.getElementById('waiting-ui');
        const activeUI = document.getElementById('active-ui');
        const projImg = document.getElementById('proj-img');
        const projName = document.getElementById('proj-name');
        const projCat = document.getElementById('proj-cat');
        const projCampus = document.getElementById('proj-campus');
        const projBase = document.getElementById('proj-base');
        const projBid = document.getElementById('proj-bid');
        const projBidder = document.getElementById('proj-bidder');
        const projAuctionCategory = document.getElementById('proj-auction-category');
        const recentBidsContainer = document.getElementById('recent-bids-container');

        let currentAuctionId = null;

        async function pollState() {
            try {
                const response = await fetch('/api/auction/state');
                const data = await response.json();

                if (data.success) {
                    updateUI(data);
                }
            } catch (error) {
                console.error('State poll failure:', error);
            }
        }

        function updateUI(data) {
            if (!data.isSessionActive || !data.auction || !data.auction.player) {
                waitingUI.classList.remove('hidden');
                activeUI.classList.add('hidden');
                currentAuctionId = null;
                return;
            }

            waitingUI.classList.add('hidden');
            activeUI.classList.remove('hidden');

            const player = data.auction.player;
            const auction = data.auction;

            // Only update if player changed or first run
            if (currentAuctionId !== player.id) {
                currentAuctionId = player.id;
                projName.textContent = player.name;
                projCat.textContent = player.category || 'PLAYER';
                projCampus.textContent = player.campus || 'N/A';
                projBase.textContent = '$' + (player.basePrice || 0).toLocaleString();
                projImg.src = player.playerImage || '/images/default-player.png';

                // Tier-based category styling
                const cat = player.auctionCategory || 'N/A';
                projAuctionCategory.textContent = cat;
                let tierStyles = 'px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest border backdrop-blur-md mb-3 inline-block';

                if (cat === 'Platinum') tierStyles += ' border-blue-500/50 bg-blue-500/20 text-blue-400';
                else if (cat === 'Diamond') tierStyles += ' border-purple-500/50 bg-purple-500/20 text-purple-400';
                else if (cat === 'Gold') tierStyles += ' border-amber-500/50 bg-amber-500/20 text-amber-500';
                else tierStyles += ' border-white/20 bg-black/40 text-white';

                projAuctionCategory.className = tierStyles;
            }

            // Always update bid info
            const newBidText = '$' + (auction.currentBid || 0).toLocaleString();
            if (projBid.textContent !== newBidText) {
                projBid.textContent = newBidText;
                projBid.classList.add('animate-bounce');
                setTimeout(() => projBid.classList.remove('animate-bounce'), 1000);
            }

            projBidder.textContent = auction.highestBidder ? `${auction.highestBidder.name} leading the bid` : 'Waiting for initial bid';

            // Update bid history
            if (data.recentBids && data.recentBids.length > 0) {
                recentBidsContainer.innerHTML = data.recentBids.slice(0, 5).map(bid => `
                <div class="flex items-center justify-between py-2 border-b border-black/5 dark:border-white/5 animate-in slide-in-from-right duration-300">
                    <span class="text-[11px] font-black dark:text-white uppercase">${bid.teamName}</span>
                    <span class="text-[11px] font-black text-lime-500 font-mono">$${bid.amount.toLocaleString()}</span>
                </div>
            `).join('');
            }
        }

        // Initialize polling
        pollState();
        setInterval(pollState, 2000);
    </script>

    <%- include('layouts/public_footer') %>